{"version":3,"sources":["webpack:///./api_auth.js","webpack:///./src/lib/resampler.js","webpack:///./src/lib/vad.js","webpack:///./src/lib/visualise.js","webpack:///./src/lib/streaming_recorder.js","webpack:///src/components/Korero.vue","webpack:///./src/components/Korero.vue?5686","webpack:///./src/components/Korero.vue","webpack:///./src/main.js"],"names":["api_auth","headers","Authorization","url","exports","_class","fromSampleRate","toSampleRate","channels","outputBufferSize","noReturn","classCallCheck_default","this","initialize","Error","resampler","bypassResampler","ratioWeight","compileInterpolationFunction","interpolate","tailExists","lastWeight","initializeBuffers","toCompile","channel","Function","buffer","outputBuffer","length","sliceAmount","subarray","error","slice","generateTailCache","Float32Array","lastOutput","VAD","options","option","fftSize","bufferLen","voice_stop","voice_start","smoothingTimeConstant","energy_offset","energy_threshold_ratio_pos","energy_threshold_ratio_neg","energy_integration","filter","f","v","source","context","debug","hasOwnProperty","hertzPerBin","sampleRate","iterationFrequency","iterationPeriod","console","log","setFilter","shape","i","iLen","j","jLen","ready","vadState","energy_threshold_pos","energy_threshold_neg","voiceTrend","voiceTrendMax","voiceTrendMin","voiceTrendStart","voiceTrendEnd","damper","analyser","createAnalyser","floatFrequencyData","frequencyBinCount","floatFrequencyDataLinear","connect","scriptProcessorNode","createScriptProcessor","destination","self","onaudioprocess","event","getFloatFrequencyData","update","monitor","logging","log_i","log_limit","triggerLog","limit","msg","fft","Math","pow","getEnergy","energy","signal","start","end","integration","canvas_id","sourceNode","audioContext","canvas","document","getElementById","canvasContext","getContext","loop","bufferLength","dataArray","Uint8Array","window","setTimeout","clearFrame","width","clientWidth","height","clientHeight","WIDTH","HEIGHT","renderFrame","requestAnimationFrame","getByteFrequencyData","fillStyle","fillRect","barWidth","parseInt","barHeight","x","s","l","clearRect","arguments","undefined","beforeRecording","pauseRecording","processAudio","afterRecording","micFailed","voiceStop","voiceStart","visCanvasID","canvasID","bitRate","bufferSize","records","sampler","Resampler","isPause","isRecording","volume","vad","vis","activity","AudioContext","webkitAudioContext","close","navigator","mediaDevices","getUserMedia","video","audio","channelCount","echoCancellation","then","_micCaptured","bind","catch","_micError","stop","processor","disconnect","stream","getTracks","forEach","track","input","output","max","min","arrayBuffer","data","out","Int16Array","_floatTo16BitPCM","_this","createMediaStreamSource","_voiceStop","_voiceStart","ev","sample","inputBuffer","getChannelData","sum","sqrt","toFixed","resampled","_convertTo16BitPCM","Korero","__webpack_require__","name","vadOn","recordingOn","recorder","buttonText","transcriptions","icon","loadRecording","status","methods","deleteObject","e","splice","stopRecording","isMobile","test","userAgent","processResult","text","current","mounted","startVAD","onclick","unshift","socket_url","socket","WebSocket","binaryType","onmessage","message","isTrusted","onclose","onerror","err","streaming_recorder","readyState","send","streamer","components_Korero","render","_vm","_h","$createElement","_c","_self","staticClass","_v","_s","class","on","loading","attrs","id","active","mobile","_e","_l","item","index","click","$event","src","audio_url","type","controls","play","staticRenderFns","src_components_Korero","normalizeComponent","ssrContext","Vue","use","vueCustomElement","customElement"],"mappings":"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","file":"static/js/app.990f.js","sourcesContent":["api_auth = {\n  headers:{\n    Authorization: \"Token YOUR_TOKEN_HERE\",\n  },\n  url: 'https://koreromaori.io/api/transcription/?method=stream'\n}\n\nexports.api_auth = api_auth\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./api_auth.js\n// module id = BLBT\n// module chunks = 1","//JavaScript Audio Resampler (c) 2011 - Grant Galitz\nexport default class {\n\n    constructor(fromSampleRate, toSampleRate, channels, outputBufferSize, noReturn) {\n        this.fromSampleRate = fromSampleRate;\n        this.toSampleRate = toSampleRate;\n        this.channels = channels | 0;\n        this.outputBufferSize = outputBufferSize;\n        this.noReturn = !!noReturn;\n        this.initialize();\n    }\n\n    initialize() {\n        //Perform some checks:\n        if (this.fromSampleRate > 0 && this.toSampleRate > 0 && this.channels > 0) {\n            if (this.fromSampleRate == this.toSampleRate) {\n                //Setup a resampler bypass:\n                this.resampler = this.bypassResampler;      //Resampler just returns what was passed through.\n                this.ratioWeight = 1;\n            }\n            else {\n                //Setup the interpolation resampler:\n                this.compileInterpolationFunction();\n                this.resampler = this.interpolate;          //Resampler is a custom quality interpolation algorithm.\n                this.ratioWeight = this.fromSampleRate / this.toSampleRate;\n                this.tailExists = false;\n                this.lastWeight = 0;\n                this.initializeBuffers();\n            }\n        }\n        else {\n            throw(new Error(\"Invalid settings specified for the resampler.\"));\n        }\n    }\n\n    compileInterpolationFunction() {\n        var toCompile = \"var bufferLength = Math.min(buffer.length, this.outputBufferSize);\\\n        if ((bufferLength % \" + this.channels + \") == 0) {\\\n            if (bufferLength > 0) {\\\n                var ratioWeight = this.ratioWeight;\\\n                var weight = 0;\";\n        for (var channel = 0; channel < this.channels; ++channel) {\n            toCompile += \"var output\" + channel + \" = 0;\"\n        }\n        toCompile += \"var actualPosition = 0;\\\n                var amountToNext = 0;\\\n                var alreadyProcessedTail = !this.tailExists;\\\n                this.tailExists = false;\\\n                var outputBuffer = this.outputBuffer;\\\n                var outputOffset = 0;\\\n                var currentPosition = 0;\\\n                do {\\\n                    if (alreadyProcessedTail) {\\\n                        weight = ratioWeight;\";\n        for (channel = 0; channel < this.channels; ++channel) {\n            toCompile += \"output\" + channel + \" = 0;\"\n        }\n        toCompile += \"}\\\n                    else {\\\n                        weight = this.lastWeight;\";\n        for (channel = 0; channel < this.channels; ++channel) {\n            toCompile += \"output\" + channel + \" = this.lastOutput[\" + channel + \"];\"\n        }\n        toCompile += \"alreadyProcessedTail = true;\\\n                    }\\\n                    while (weight > 0 && actualPosition < bufferLength) {\\\n                        amountToNext = 1 + actualPosition - currentPosition;\\\n                        if (weight >= amountToNext) {\";\n        for (channel = 0; channel < this.channels; ++channel) {\n            toCompile += \"output\" + channel + \" += buffer[actualPosition++] * amountToNext;\"\n        }\n        toCompile += \"currentPosition = actualPosition;\\\n                            weight -= amountToNext;\\\n                        }\\\n                        else {\";\n        for (channel = 0; channel < this.channels; ++channel) {\n            toCompile += \"output\" + channel + \" += buffer[actualPosition\" + ((channel > 0) ? (\" + \" + channel) : \"\") + \"] * weight;\"\n        }\n        toCompile += \"currentPosition += weight;\\\n                            weight = 0;\\\n                            break;\\\n                        }\\\n                    }\\\n                    if (weight == 0) {\";\n        for (channel = 0; channel < this.channels; ++channel) {\n            toCompile += \"outputBuffer[outputOffset++] = output\" + channel + \" / ratioWeight;\"\n        }\n        toCompile += \"}\\\n                    else {\\\n                        this.lastWeight = weight;\";\n        for (channel = 0; channel < this.channels; ++channel) {\n            toCompile += \"this.lastOutput[\" + channel + \"] = output\" + channel + \";\"\n        }\n        toCompile += \"this.tailExists = true;\\\n                        break;\\\n                    }\\\n                } while (actualPosition < bufferLength);\\\n                return this.bufferSlice(outputOffset);\\\n            }\\\n            else {\\\n                return (this.noReturn) ? 0 : [];\\\n            }\\\n        }\\\n        else {\\\n            throw(new Error(\\\"Buffer was of incorrect sample length.\\\"));\\\n        }\";\n        this.interpolate = Function(\"buffer\", toCompile);\n    }\n    \n    bypassResampler(buffer) {\n        if (this.noReturn) {\n            //Set the buffer passed as our own, as we don't need to resample it:\n            this.outputBuffer = buffer;\n            return buffer.length;\n        }\n        else {\n            //Just return the buffer passsed:\n            return buffer;\n        }\n    }\n    \n    bufferSlice(sliceAmount) {\n        if (this.noReturn) {\n            //If we're going to access the properties directly from this object:\n            return sliceAmount;\n        }\n        else {\n            //Typed array and normal array buffer section referencing:\n            try {\n                return this.outputBuffer.subarray(0, sliceAmount);\n            }\n            catch (error) {\n                try {\n                    //Regular array pass:\n                    this.outputBuffer.length = sliceAmount;\n                    return this.outputBuffer;\n                }\n                catch (error) {\n                    //Nightly Firefox 4 used to have the subarray function named as slice:\n                    return this.outputBuffer.slice(0, sliceAmount);\n                }\n            }\n        }\n    }\n    \n    initializeBuffers(generateTailCache) {\n        //Initialize the internal buffer:\n        try {\n            this.outputBuffer = new Float32Array(this.outputBufferSize);\n            this.lastOutput = new Float32Array(this.channels);\n        }\n        catch (error) {\n            this.outputBuffer = [];\n            this.lastOutput = [];\n        }\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/resampler.js","\nexport default class VAD {\n\n  constructor(options) {\n    // Default options\n    this.options = {\n      fftSize: 512*.5,\n      bufferLen: 512*.5, \n      voice_stop: function() {},\n      voice_start: function() {},\n      smoothingTimeConstant: 0.99, \n      energy_offset: 1e-8, // The initial offset.\n      energy_threshold_ratio_pos: 4, // Signal must be twice the offset\n      energy_threshold_ratio_neg: 0.25, // Signal must be half the offset\n      energy_integration: 1, // Size of integration change compared to the signal per second.\n      filter: [\n        {f: 200, v:0}, // 0 -> 200 is 0\n        {f: 2000, v:1} // 200 -> 2k is 1\n      ],\n      source: null,\n      context: null,\n      debug: false,\n    };\n\n    // User options\n    for(var option in options) {\n      if(options.hasOwnProperty(option)) {\n        this.options[option] = options[option];\n      }\n    }\n\n    // Require source\n   if(!this.options.source)\n     throw new Error(\"The options must specify a MediaStreamAudioSourceNode.\");\n\n    // Set this.options.context\n    this.options.context = this.options.source.context;\n\n    // Calculate time relationships\n    this.hertzPerBin = this.options.context.sampleRate / this.options.fftSize;\n    this.iterationFrequency = this.options.context.sampleRate / this.options.bufferLen;\n    this.iterationPeriod = 1 / this.iterationFrequency;\n\n    var DEBUG = this.options.debug;\n    if(DEBUG) {console.log(\n      'Vad' +\n      ' | sampleRate: ' + this.options.context.sampleRate +\n      ' | hertzPerBin: ' + this.hertzPerBin +\n      ' | iterationFrequency: ' + this.iterationFrequency +\n      ' | iterationPeriod: ' + this.iterationPeriod\n    )};\n\n    this.setFilter = function(shape) {\n      this.filter = [];\n      for(var i = 0, iLen = this.options.fftSize / 2; i < iLen; i++) {\n        this.filter[i] = 0;\n        for(var j = 0, jLen = shape.length; j < jLen; j++) {\n          if(i * this.hertzPerBin < shape[j].f) {\n            this.filter[i] = shape[j].v;\n            break; // Exit j loop\n          }\n        }\n      }\n    }\n\n    this.setFilter(this.options.filter);\n\n    this.ready = {};\n    this.vadState = false; // True when Voice Activity Detected\n\n    // Energy detector props\n    this.energy_offset = this.options.energy_offset;\n    this.energy_threshold_pos = this.energy_offset * this.options.energy_threshold_ratio_pos;\n    this.energy_threshold_neg = this.energy_offset * this.options.energy_threshold_ratio_neg;\n\n    this.voiceTrend = 0;\n    this.voiceTrendMax = 10*1.5;\n    this.voiceTrendMin = -5;\n    this.voiceTrendStart = 2;\n    this.voiceTrendEnd = -5;\n    this.damper = 0.02\n    this.voiceTrendMin = this.voiceTrendEnd - this.damper/10;\n    // Create analyser \n    this.analyser = this.options.context.createAnalyser();\n    this.analyser.smoothingTimeConstant = this.options.smoothingTimeConstant; // 0.99;\n    this.analyser.fftSize = this.options.fftSize;\n\n    this.floatFrequencyData = new Float32Array(this.analyser.frequencyBinCount);\n\n    // Setup local storage of the Linear FFT data\n    this.floatFrequencyDataLinear = new Float32Array(this.floatFrequencyData.length);\n\n    // Connect this.analyser\n    this.options.source.connect(this.analyser); \n\n    // Create ScriptProcessorNode\n    this.scriptProcessorNode = this.options.context.createScriptProcessor(this.options.bufferLen, 1, 1);\n\n    // Connect scriptProcessorNode (Theretically, not required)\n    this.scriptProcessorNode.connect(this.options.context.destination);\n\n    // Create callback to update/analyze floatFrequencyData\n    var self = this;\n    this.scriptProcessorNode.onaudioprocess = function(event) {\n      self.analyser.getFloatFrequencyData(self.floatFrequencyData);\n      self.update();\n      self.monitor();\n    };\n\n    // Connect scriptProcessorNode\n    this.options.source.connect(this.scriptProcessorNode);\n\n    // log stuff\n    this.logging = false;\n    this.log_i = 0;\n    this.log_limit = 100;\n\n    this.triggerLog = function(limit) {\n      this.logging = true;\n      this.log_i = 0;\n      this.log_limit = typeof limit === 'number' ? limit : this.log_limit;\n    }\n\n    this.log = function(msg) {\n      if(this.logging && this.log_i < this.log_limit) {\n        this.log_i++;\n        console.log(msg);\n      } else {\n        this.logging = false;\n      }\n    }\n\n    this.update = function() {\n      // Update the local version of the Linear FFT\n      var fft = this.floatFrequencyData;\n      for(var i = 0, iLen = fft.length; i < iLen; i++) {\n        this.floatFrequencyDataLinear[i] = Math.pow(10, fft[i] / 10);\n      }\n      this.ready = {};\n    }\n\n    this.getEnergy = function() {\n      if(this.ready.energy) {\n        return this.energy;\n      }\n\n      var energy = 0;\n      var fft = this.floatFrequencyDataLinear;\n\n      for(var i = 0, iLen = fft.length; i < iLen; i++) {\n        energy += this.filter[i] * fft[i] * fft[i];\n      }\n\n      this.energy = energy;\n      this.ready.energy = true;\n\n      return energy;\n    }\n\n    this.monitor = function() {\n      var energy = this.getEnergy();\n      var signal = energy - this.energy_offset;\n\n      if(signal > this.energy_threshold_pos) {\n        this.voiceTrend = (this.voiceTrend + 1 > this.voiceTrendMax) ? this.voiceTrendMax : this.voiceTrend + 1;\n      } else if(signal < -this.energy_threshold_neg) {\n        this.voiceTrend = (this.voiceTrend - 1 < this.voiceTrendMin) ? this.voiceTrendMin : this.voiceTrend - 1*(this.vadState ? this.damper : 10);\n      } else {\n        // voiceTrend gets smaller\n        if(this.voiceTrend > 0) {\n          this.voiceTrend--;\n        } else if(this.voiceTrend < 0) {\n          this.voiceTrend++;\n        }\n      }\n\n      var start = false, end = false;\n      if(this.voiceTrend > this.voiceTrendStart) {\n        // Start of speech detected\n        start = true;\n      } else if(this.voiceTrend < this.voiceTrendEnd) {\n        // End of speech detected\n        end = true;\n      }\n\n      // Integration brings in the real-time aspect through the relationship with the frequency this functions is called.\n      var integration = signal * this.iterationPeriod * this.options.energy_integration;\n\n      // Idea?: The integration is affected by the voiceTrend magnitude? - Not sure. Not doing atm.\n\n      // The !end limits the offset delta boost till after the end is detected.\n      if(integration > 0 || !end) {\n        this.energy_offset += integration;\n      } else {\n        this.energy_offset += integration * 10;\n      }\n      this.energy_offset = this.energy_offset < 0 ? 0 : this.energy_offset;\n      this.energy_threshold_pos = this.energy_offset * this.options.energy_threshold_ratio_pos;\n      this.energy_threshold_neg = this.energy_offset * this.options.energy_threshold_ratio_neg;\n\n      // Broadcast the messages\n      if(start && !this.vadState) {\n        this.vadState = true;\n        this.options.voice_start();\n      }\n      if(end && this.vadState) {\n        this.vadState = false;\n        this.options.voice_stop();\n      }\n\n      this.log(\n        'e: ' + energy +\n        ' | e_of: ' + this.energy_offset +\n        ' | e+_th: ' + this.energy_threshold_pos +\n        ' | e-_th: ' + this.energy_threshold_neg +\n        ' | signal: ' + signal +\n        ' | int: ' + integration +\n        ' | voiceTrend: ' + this.voiceTrend +\n        ' | start: ' + start +\n        ' | end: ' + end\n      );\n\n      return signal;\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/vad.js","\nexport default class {\n\n  constructor(canvas_id, sourceNode, audioContext){\n    var self = this\n    this.canvas = document.getElementById(canvas_id)\n    this.canvasContext = this.canvas.getContext(\"2d\")\n    this.loop = false\n    this.sourceNode = sourceNode\n    this.audioContext = audioContext\n    this.analyser = audioContext.createAnalyser();\n    this.analyser.fftSize = 32;\n\n\n    this.sourceNode.connect(this.analyser);\n    \n    this.bufferLength = this.analyser.frequencyBinCount;\n    this.dataArray = new Uint8Array(this.analyser.fftSize);\n\n  }\n\n  stop(){\n    this.loop = false\n    var self = this\n    window.setTimeout(function(){self.clearFrame()}, 200)\n  }\n\n  start(){\n    this.canvas.width = this.canvas.clientWidth;\n    this.canvas.height = this.canvas.clientHeight;    \n    this.WIDTH = this.canvas.clientWidth;\n    this.HEIGHT = this.canvas.clientHeight;    \n    this.loop = true\n    this.renderFrame();\n  }\n\n  renderFrame() {\n    var self = this\n    if (self.loop){\n      \n        window.requestAnimationFrame(function(){self.renderFrame()});\n        self.analyser.getByteFrequencyData(self.dataArray);\n        // self.canvasContext.clearRect(0, 0, self.WIDTH, self.HEIGHT);\n        self.canvasContext.fillStyle = \"#333\";\n        self.canvasContext.fillRect(0, 0, self.WIDTH, self.HEIGHT);\n\n        var barWidth = parseInt((self.WIDTH / self.bufferLength))\n        var barHeight = 0\n        var x = 0;\n\n        for (var i = 0; i < self.bufferLength/2; i++) {\n          barHeight = parseInt(self.dataArray[i]/255*self.HEIGHT*.9);\n          \n          var h = 345\n          var s = parseInt(73 * ( self.HEIGHT/barHeight * .5) )\n          var l = parseInt(90 * ( barHeight/self.HEIGHT))\n          \n          self.canvasContext.fillStyle = \"hsl(\" + h + \",\" + s + \"%,\" + l + \"%)\";\n          self.canvasContext.fillRect(2*x+1, self.HEIGHT - barHeight, 2*barWidth-2, barHeight);\n\n          x += barWidth;\n\n      }\n      \n    } else {\n      return;\n    }\n  }\n\n  clearFrame(){\n    var self = this\n    self.canvasContext.clearRect(0, 0, self.WIDTH, self.HEIGHT);\n    self.canvasContext.fillStyle = \"#333\";\n    self.canvasContext.fillRect(0, 0, self.WIDTH, self.HEIGHT);    \n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/visualise.js","import Resampler from './resampler'\nimport VAD from './vad.js'\nimport vis from './visualise'\n\nexport default class {\n  constructor (options = {}) {\n    this.beforeRecording   = options.beforeRecording\n    this.pauseRecording    = options.pauseRecording\n    this.processAudio      = options.processAudio\n    this.afterRecording    = options.afterRecording\n    this.micFailed         = options.micFailed\n    this.voiceStop         = options.voiceStop\n    this.voiceStart        = options.voiceStart\n    this.visCanvasID       = options.canvasID || null\n\n    this.bitRate = options.bitRate || 96\n    this.sampleRate = options.sampleRate || 44100\n    this.bufferSize = 4096\n    this.records    = []\n\n    this.sampler = new Resampler(this.sampleRate, 16000, 1, this.bufferSize)\n\n    this.isPause     = false\n    this.isRecording = false\n\n    this.volume   = 0\n\n    this.vad = null\n    this.vis = null\n    this.activity = false\n\n    this.vis = null\n\n    // Set Sample Rate according to device and browser campability\n    this.context = new(window.AudioContext || window.webkitAudioContext)()\n    this.sampleRate = this.context.sampleRate\n    this.context.close()\n  }\n\n\n  start () {\n    const constraints = {\n      video: false,\n      audio: {\n        channelCount: 1,\n        echoCancellation: true\n      }\n    }\n\n    this.beforeRecording && this.beforeRecording('start recording')\n\n    navigator.mediaDevices\n             .getUserMedia(constraints)\n             .then(this._micCaptured.bind(this))\n             .catch(this._micError.bind(this))\n    this.isPause = false\n    this.isRecording = true\n\n  }\n\n  stop () {\n    if (this.vis){\n      this.vis.stop()\n    }\n\n    // this.stream.getTracks().forEach((track) => track.stop())\n    // this.input.disconnect()\n    if (this.processor)\n      this.processor.disconnect()\n    if (this.context)\n      this.context.close()\n\n    this.isPause     = false\n    this.isRecording = false\n\n    \n  }\n\n  pause () {\n    this.stream.getTracks().forEach((track) => track.stop())\n    this.input.disconnect()\n    this.processor.disconnect()\n    this.context.close()\n\n    this.isPause = true\n\n    this.pauseRecording && this.pauseRecording('pause recording')\n  }\n\n  recordList () {\n    return this.records\n  }\n\n  lastRecord () {\n    return this.records.slice(-1)\n  }\n\n  _floatTo16BitPCM(input, output) {\n    for (let i = 0; i < input.length; i++) {\n      const s = Math.max(-1, Math.min(1, input[i]))\n      output[i] = (s < 0 ? s * 0x8000 : s * 0x7FFF)\n    }\n  }\n\n  _convertTo16BitPCM(arrayBuffer) {\n    const data = new Float32Array(arrayBuffer)\n    const out = new Int16Array(arrayBuffer.length)\n    this._floatTo16BitPCM(data, out)\n    return out\n  }\n\n  _micCaptured (stream) {\n    this.context    = new(window.AudioContext || window.webkitAudioContext)({sampleRate: this.sampleRate})\n    this.input      = this.context.createMediaStreamSource(stream)\n    this.processor  = this.context.createScriptProcessor(this.bufferSize, 1, 1)\n    this.stream     = stream\n\n    this._voiceStop = () => {\n      this.voiceStop()\n      this.activity = false\n      if (this.afterRecording) {\n          this.afterRecording();\n      }\n    }\n    this._voiceStart = () => {\n      this.voiceStart()\n      this.activity = true\n    }\n\n    // Create VAD\n    var options = {\n      debug: false,\n      source: this.input,\n      voice_stop: this._voiceStop,\n      voice_start: this._voiceStart,\n    };         \n    this.vad = new VAD(options)\n    \n    // create visualisation\n    if (this.visCanvasID){\n      try{\n        this.vis = new vis(this.visCanvasID, this.input, this.input.context)\n        this.vis.start()\n      } catch(error){\n        console.log(error)\n      }\n    }\n\n    this.processor.onaudioprocess = (ev) => {\n      var sample = ev.inputBuffer.getChannelData(0);\n\n      //work out volume\n      let sum = 0.0\n      for (let i = 0; i < sample.length; ++i) {\n        sum += sample[i] * sample[i]\n      }\n      this.volume = Math.sqrt(sum / sample.length).toFixed(2)\n\n      // streaming callback to processAudio \n      // - if we're in voice detection and the callback is defined\n      if (this.activity) {\n        if (this.processAudio) {\n            var resampled = this.sampler.resampler(sample);\n            var buffer = this._convertTo16BitPCM(resampled)\n            this.processAudio(buffer);\n        }\n      }\n    }\n\n    this.input.connect(this.processor)\n    this.processor.connect(this.context.destination)\n  }\n\n  _micError (error) {\n    this.micFailed && this.micFailed(error)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/streaming_recorder.js","<template>\n  <div class=\"Korero\">\n    <div class=\"header\">\n      <h4>Kōrero Māori Streaming ASR (Demo)</h4>\n      <div class='status'> {{status}}</div>\n      <button id=\"startVAD\" v-bind:class=\"{ vad: vadOn, on: recordingOn, 'loading': loadRecording}\">\n        <i class=\"fa fa-microphone\" ></i>\n        <i class=\"fa fa-stop\" ></i>\n        <i class=\"fa fa-spinner fa-spin\"></i>\n      </button>\n      <div id=\"vadStatus\" v-bind:class=\"{ active: vadOn, 'mobile': isMobile()}\">\n        <div>\n          <canvas id=\"canvas\" v-if=\"!isMobile()\"></canvas>\n          <span v-if=\"isMobile() && vadOn && recordingOn\">Voice Detected</span>\n          <span v-if=\"isMobile() && recordingOn && !vadOn\">Listening</span>\n          <span v-if=\"isMobile()\">Hit Record</span>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"body\">\n      <div id=\"transcriptions\">\n        <div v-for=\"(item, index) in transcriptions\" class='transcription' v-bind:class=\"[item.status]\" v-if=\"item.status != 'Failed'\"> \n          <button class=\"delete\" v-if=\"item.status != 'Transcribing'\" v-on:click=\"deleteObject(index)\"><i class=\"fa fa-times\"></i></button>\n          <div class='text'>\n            <i class=\"fa fa-spinner fa-spin\" v-bind:class=\"[item.status]\" v-if=\"item.status == 'Transcribing'\" ></i>\n          \n            <div v-if=\"item.status != 'Transcribing'\">{{item.text}}</div>\n        \n          </div>\n          <div class=\"audio\">\n            <audio v-if=\"item.audio_url\" :src=\"item.audio_url\" type=\"audio/mp3\" controls v-on:play=\"stopRecording\"></audio>\n          </div>\n\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport recorder from '../lib/streaming_recorder.js';\nconst ApiAuth = require('../../api_auth');\nconst api_auth = ApiAuth.api_auth;\n// import 'ws-audio-api';\n// const streamer = WSAudioAPI.Streamer();\n//const axios = require('axios');\nexport default {\n  name: 'Kōrero',\n  data () {\n    return {\n      vadOn: false,\n      recordingOn: false,\n      recorder: null,\n      buttonText: 'Start',\n      transcriptions: [],\n      icon: 'fa-microphone',\n      loadRecording: false,\n      status: ''\n    }\n  },\n  methods: {\n    deleteObject: function (e) {\n      this.transcriptions.splice(e, 1)\n    },\n    stopRecording: function () {\n      try{this.recorder.stop();}\n      catch(e){}\n      this.recorder=null;\n      this.vadOn = false;\n      this.recordingOn = false\n    },   \n    isMobile() {\n      if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Mobile|SamsungBrowser|Opera Mini/i.test(navigator.userAgent)) {\n        console.log(navigator.userAgent)\n        return true\n      } else {\n        return false\n      }\n    },\n    processResult: function(text) {\n      var current = this.transcriptions[0];\n      if (current) {\n          current.text = text;\n          current.status = 'Success';\n      }\n    },\n\n  },\n  mounted: function () {\n\n    startVAD.onclick = event => {\n      if (this.recorder==null) {\n        this.loadRecording = true;\n        this.transcriptions.unshift({text: null})\n\n        // -- make  websocket \n        var socket_url = process.env.ASR_WEBSOCKET_ENDPOINT;\n        this.status = \"Connecting to \" + socket_url;\n        this.socket = new WebSocket(socket_url);\n        this.socket.binaryType = 'arraybuffer';\n        var self = this;\n        this.socket.onmessage = function(message) {\n          self.status = \"Connected to \" + socket_url;\n          if (message.isTrusted) {\n              self.processResult(message.data);\n          }\n        };\n        this.socket.onclose = function () {\n           self.status = \"Service unavailable\";\n           console.log('Connection to server closed');\n        };\n        this.socket.onerror = function (err) {\n           self.status = \"Error getting data\";\n           console.log('Getting audio data error:', err);\n        };\n        // -- /make websocket\n\n        this.recorder = new recorder({\n         \n          processAudio  : (buffer) => {\n            if (this.socket.readyState == 1)  {\n              this.socket.send(buffer);\n            }\n          },\n\n          afterRecording  : (stream) => {\n            if (this.socket.readyState == 1)  {\n              this.socket.send('EOS');\n            }\n            //this.buttonText = 'Start' \n            //this.recorder=null;\n          },\n\n          pauseRecording  : function() {\n            streamer.stop();\n            console.log('paused')\n          },\n          micFailed       : function(){console.log('failed')},\n          voiceStop: () => {\n            this.vadOn = false\n          },\n          voiceStart: () => {\n            this.vadOn = true\n          },\n          canvasID: this.isMobile() ? null : 'canvas',\n          bitRate         : 64,\n          sampleRate      : 44100,\n          // format          : this.format\n        })\n      }\n\n      if (this.recordingOn) {\n        this.recorder.stop();\n        this.recorder=null;\n        this.vadOn = false;\n        this.recordingOn = false\n        // this.buttonText = 'Start'\n      } else {\n        this.recorder.start()\n        this.recordingOn = true\n        this.buttonText = 'Stop'\n        this.loadRecording = false\n      }\n\n    }\n  }\n}\n\n\n// the non-streaming alternative\n // putRecording : (record) => {\n //            var transcription = {\n //              status: 'Transcribing',\n //              text: null,\n //              audio: null,\n //            }\n //            this.transcriptions.unshift(transcription)\n //            var formData = new FormData();\n //            formData.enctype=\"multipart/form-data\";\n //            formData.append('audio_file', record.blob, 'audio_file.mp3')            \n //            axios.post(\n //              api_auth['url'],\n //              formData,\n //              {\n //                headers: api_auth['headers'],\n //              })\n //            .then((response) => {\n //              if (response.data.transcription == '' || response.data.transcription == ' ' ){\n //                transcription.status = 'Failed'\n //                return\n //              }\n //              transcription['text'] = response.data.transcription\n //              transcription['show_metadata'] = false\n //              if (response.data.metadata){\n //                console.log('getting response.data.metadata')\n //                transcription['show_metadata'] = true\n //                transcription['metadata'] = response.data.metadata\n\n //                var words = []\n //                var probs = []\n //                var prob = []\n //                var word = ''\n //                var start = 0\n //                for (var i=0; i <response.data.metadata.length; i++){\n //                  word = word + response.data.metadata[i].char\n //                  prob.push(response.data.metadata[i].prob)\n //                  if (response.data.metadata[i].char != ' '){\n //                    continue\n //                  } else {\n //                    words.push({'word': word, 'prob': this.p_word(prob)})\n //                    prob = []\n //                    start = i\n //                    word = ''\n //                  }\n //                } \n //                words.push({'word': word, 'prob': this.p_word(prob)})\n //                console.log(words)\n //                transcription['words'] = words\n //                console.log(transcription['metadata'])\n //              } else {\n //                console.log('NO response.data.metadata')\n //              }\n              \n //              transcription['audio_url'] = record.url\n //              transcription['status'] = 'Success'\n //            })\n //            .catch((error) => {\n //              transcription.status = 'Failed'\n //            })\n //          },\n</script>\n\n<style scoped>\n\n.Korero {\n  font-family: 'Avenir', Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  text-align: center;\n  color: #2c3e50;\n  font-size: 14px;\n}\nbutton.delete{\n  position: absolute;\n  right: 0px;\n  top: 0px;\n  display: block;\n  border: 0px;\n  margin: 2px;\n  font-size: 0.7em;\n  color: #696969;\n  cursor: pointer;\n  outline: none;\n  background: none;\n}\n.transcription{\n  position: relative;\n  width: 100%;\n  margin: 20px 30px 20px 30px;\n  max-width: 500px;\n  /*margin-top: 20px; */\n  font-size: 1.5em;\n  border-radius: 8px;\n  /*box-shadow: 0px 2px 6px -2px rgba(0,0,0,1)  */\n  border: 1px solid black;\n}\n.transcription.Transcribing{\n  border: 0px;\n}\n.transcription .text {\n  padding: 15px 20px;\n}\n.transcription:nth-of-type(1){\n  margin-top: 40px;\n}\n\ndiv.transcription.Success div.text [class*=fa]{\n  display: none;\n}\n.Korero, .header, .body{\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n}\n.body{\n  height: 100vh;\n  margin-top: -225px;\n}\n.header{\n  padding-bottom: 15px;\n  z-index: 1;\n  background-color: white;\n  padding-left: 15px;\n  padding-right: 15px;  \n}\n.header .status {\n  margin-top: -15px;\n  margin-bottom: 15px;\n  font-style: italic;\n}\n\n#transcriptions{\n  z-index: 0;\n  display: flex;\n  flex-direction: column;\n  overflow-y: scroll;\n  flex-wrap: nowrap;\n  -webkit-overflow-scrolling: touch;\n  -ms-overflow-style: -ms-autohiding-scrollbar; \n  align-items: center;  \n  margin-top: 232px;\n  height: 100vh;    \n  padding-left: 15px;\n  padding-right: 15px;\n}\n\n#vadStatus{\n  display: flex;\n  width: 100%;\n  max-width: 500px;  \n  height: 100px;\n  align-self: center;\n  align-items: center;\n}\n#vadStatus canvas{\n  z-index: 1;\n  display: block;\n  height: 100%;\n  width: 100%;\n  background-color: #333;\n}\n#vadStatus div{\n  height: 100%;\n  width: 100%;\n  border: 4px solid black;\n  border-radius: 4px;\n}\n#vadStatus.active div{\n  border-color: red;\n}\n#vadStatus.mobile{\n  height: 28px;\n  max-width: 150px;  \n}\n#vadStatus.mobile div span{\n  display: block;\n  padding: 4px;\n}\n#vadStatus.mobile div{\n  color: white;\n  font-weight: 700;\n  background-color: black;\n}\n#vadStatus.mobile.active div{\n  background-color: red;\n}\n#startVAD {\n  z-index: 2;\n  align-self: center;\n  margin: 15px;\n  outline: none;\n  background-color: rgb(40,40,40);\n  color: white;\n  width: 80px;\n  height: 80px;\n  border: 2px solid black;\n  border-radius: 40px;\n  padding: 8px 16px;\n  cursor: pointer;\n}\n#startVAD [class*=fa]{\n  font-size: 34px !important;\n}\n#startVAD.on {\n  background-color: rgba(255, 40, 40, 0.75);\n  border-color: rgb(200, 40, 40);\n}\n#startVAD.on.vad {\n  background-color: rgba(255, 40, 40, 1);\n}\n#startVAD.on .fa-microphone{\n  display: none;\n}\n#startVAD .fa-stop, #startVAD .fa-spinner{\n  display: none;\n}\n#startVAD.on .fa-stop{\n  display: initial;\n}\n#startVAD.on.loading .fa-spinner{\n  display: initial;\n}\naudio{\n  outline: none;\n  width: 100%;\n  padding-bottom: 15px;\n}\n.audio{\n  padding: 0px 15px 0px 15px;\n}\n\ndiv.confidence{\n  display: inline-flex;\n  flex-wrap: wrap;\n}\ndiv.char{\n  /*line-height: 20px;*/\n}\ndiv.char-wrapper{\n  width: 20px;\n  display: inline-block;\n  text-align: center;\n}\ndiv.word{\n  margin-right: 20px;\n}\ndiv.word:last-child{\n  margin-right: 0px;\n}\ndiv.word-wrapper{\n  /*width: 20px*/\n}\nspan.char{\n  display: inline-block;\n  width: 20px;\n  text-align: center;\n}\nspan.prob{\n  display: inline-block;\n  font-size: 8px;\n  /*line-he*/ight: 0px;\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/Korero.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"Korero\"},[_c('div',{staticClass:\"header\"},[_c('h4',[_vm._v(\"Kōrero Māori Streaming ASR (Demo)\")]),_vm._v(\" \"),_c('div',{staticClass:\"status\"},[_vm._v(\" \"+_vm._s(_vm.status))]),_vm._v(\" \"),_c('button',{class:{ vad: _vm.vadOn, on: _vm.recordingOn, 'loading': _vm.loadRecording},attrs:{\"id\":\"startVAD\"}},[_c('i',{staticClass:\"fa fa-microphone\"}),_vm._v(\" \"),_c('i',{staticClass:\"fa fa-stop\"}),_vm._v(\" \"),_c('i',{staticClass:\"fa fa-spinner fa-spin\"})]),_vm._v(\" \"),_c('div',{class:{ active: _vm.vadOn, 'mobile': _vm.isMobile()},attrs:{\"id\":\"vadStatus\"}},[_c('div',[(!_vm.isMobile())?_c('canvas',{attrs:{\"id\":\"canvas\"}}):_vm._e(),_vm._v(\" \"),(_vm.isMobile() && _vm.vadOn && _vm.recordingOn)?_c('span',[_vm._v(\"Voice Detected\")]):_vm._e(),_vm._v(\" \"),(_vm.isMobile() && _vm.recordingOn && !_vm.vadOn)?_c('span',[_vm._v(\"Listening\")]):_vm._e(),_vm._v(\" \"),(_vm.isMobile())?_c('span',[_vm._v(\"Hit Record\")]):_vm._e()])])]),_vm._v(\" \"),_c('div',{staticClass:\"body\"},[_c('div',{attrs:{\"id\":\"transcriptions\"}},_vm._l((_vm.transcriptions),function(item,index){return (item.status != 'Failed')?_c('div',{staticClass:\"transcription\",class:[item.status]},[(item.status != 'Transcribing')?_c('button',{staticClass:\"delete\",on:{\"click\":function($event){return _vm.deleteObject(index)}}},[_c('i',{staticClass:\"fa fa-times\"})]):_vm._e(),_vm._v(\" \"),_c('div',{staticClass:\"text\"},[(item.status == 'Transcribing')?_c('i',{staticClass:\"fa fa-spinner fa-spin\",class:[item.status]}):_vm._e(),_vm._v(\" \"),(item.status != 'Transcribing')?_c('div',[_vm._v(_vm._s(item.text))]):_vm._e()]),_vm._v(\" \"),_c('div',{staticClass:\"audio\"},[(item.audio_url)?_c('audio',{attrs:{\"src\":item.audio_url,\"type\":\"audio/mp3\",\"controls\":\"\"},on:{\"play\":_vm.stopRecording}}):_vm._e()])]):_vm._e()}),0)])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-bf9dde80\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Korero.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-bf9dde80\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Korero.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Korero.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Korero.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-bf9dde80\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./Korero.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-bf9dde80\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Korero.vue\n// module id = null\n// module chunks = ","import Vue from 'vue'\nimport Korero from '@/components/Korero'\nimport vueCustomElement from 'vue-custom-element'\nVue.use(vueCustomElement)\nVue.customElement('vue-widget', Korero)\n\n\n\n// WEBPACK FOOTER //\n// ./src/main.js"],"sourceRoot":""}