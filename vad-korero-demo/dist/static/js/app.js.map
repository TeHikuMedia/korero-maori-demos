{"version":3,"sources":["webpack:///./api_auth.js","webpack:///./src/lib/encoder.js","webpack:///./src/lib/vad.js","webpack:///./src/lib/visualize.js","webpack:///./src/lib/recorder.js","webpack:///src/components/Korero.vue","webpack:///./src/components/Korero.vue?9b60","webpack:///./src/components/Korero.vue","webpack:///./src/main.js"],"names":["api_auth","headers","url","exports","_class","config","classCallCheck_default","this","bitRate","sampleRate","dataBuffer","encoder","Mp3Encoder","X","slice","length","arrayBuffer","samples","_convertBuffer","remaining","i","left","subarray","buffer","encodeBuffer","push","Int8Array","flush","blob","Blob","type","id","Date","now","URL","createObjectURL","input","output","s","Math","max","min","data","Float32Array","out","Int16Array","_floatTo16BitPCM","VAD","options","option","fftSize","bufferLen","voice_stop","voice_start","smoothingTimeConstant","energy_offset","energy_threshold_ratio_pos","energy_threshold_ratio_neg","energy_integration","filter","f","v","source","context","debug","hasOwnProperty","Error","hertzPerBin","iterationFrequency","iterationPeriod","console","log","setFilter","shape","iLen","j","jLen","ready","vadState","energy_threshold_pos","energy_threshold_neg","voiceTrend","voiceTrendMax","voiceTrendMin","voiceTrendStart","voiceTrendEnd","damper","analyser","createAnalyser","floatFrequencyData","frequencyBinCount","floatFrequencyDataLinear","connect","scriptProcessorNode","createScriptProcessor","destination","self","onaudioprocess","event","getFloatFrequencyData","update","monitor","logging","log_i","log_limit","triggerLog","limit","msg","fft","pow","getEnergy","energy","signal","start","end","integration","canvas_id","sourceNode","audioContext","canvas","document","getElementById","canvasContext","getContext","loop","bufferLength","dataArray","Uint8Array","window","setTimeout","clearFrame","width","clientWidth","height","clientHeight","WIDTH","HEIGHT","renderFrame","requestAnimationFrame","getByteFrequencyData","fillStyle","fillRect","barWidth","parseInt","barHeight","x","l","clearRect","arguments","undefined","beforeRecording","pauseRecording","putRecording","afterRecording","micFailed","voiceStop","voiceStart","visCanvasID","canvasID","bufferSize","records","isPause","isRecording","duration","volume","_duration","vad","vis","activity","AudioContext","webkitAudioContext","close","navigator","mediaDevices","getUserMedia","video","audio","channelCount","echoCancellation","then","_micCaptured","bind","catch","_micError","lameEncoder","Encoder","stop","stream","getTracks","forEach","track","disconnect","processor","record","finish","convertTimeMMSS","_this","createMediaStreamSource","_voiceStop","put","_voiceStart","error","ev","flushPrevious","sample","inputBuffer","getChannelData","sum","encode","parseFloat","currentTime","toFixed","sqrt","__webpack_require__","axios","Korero","name","vadOn","recordingOn","recorder","buttonText","transcriptions","icon","loadRecording","methods","deleteObject","e","splice","stopRecording","isMobile","test","userAgent","mounted","startVAD","onclick","transcription","status","text","unshift","formData","FormData","enctype","append","post","response","metadata","components_Korero","render","_vm","_h","$createElement","_c","_self","staticClass","class","on","loading","attrs","_v","active","mobile","_e","_l","item","index","click","$event","character","char","style","backgroundColor","prob","_s","src","audio_url","controls","play","staticRenderFns","src_components_Korero","normalizeComponent","ssrContext","Vue","use","vueCustomElement","customElement"],"mappings":"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","file":"static/js/app.js","sourcesContent":["\nif (process.env.NODE_ENV === 'development'){\n\tapi_auth = {\n\t\theaders:{\n\t\t\tAuthorization: \"Token 0d0f9ebb85d621d7853052cd17f370e481379c6f\",\n\t\t},\n\t\turl: 'https://dev.koreromaori.io/api/transcription/?method=stream'\n\t}\t\t\n} else {\n\tapi_auth = {\n\t\theaders:{\n\t\t},\n\t\turl: '/api/transcription/?method=stream'\n\t}\t\n}\n\n\nexports.api_auth = api_auth\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./api_auth.js\n// module id = BLBT\n// module chunks = 1","import { Mp3Encoder } from 'lamejs'\n\nexport default class {\n  constructor(config) {\n    this.bitRate    = config.bitRate || 96\n    this.sampleRate = config.sampleRate || 44100\n    this.dataBuffer = []\n    this.encoder    = new Mp3Encoder(1, this.sampleRate, this.bitRate)\n  }\n\n  flushPrevious(X){\n    // This clears X items in the buffer\n    this.dataBuffer = this.dataBuffer.slice(this.dataBuffer.length - X)\n  }\n\n  encode(arrayBuffer) {\n    const maxSamples = 1152\n    const samples    = this._convertBuffer(arrayBuffer)\n    let remaining    = samples.length\n\n    for (let i = 0; remaining >= 0; i += maxSamples) {\n      const left = samples.subarray(i, i + maxSamples)\n      const buffer = this.encoder.encodeBuffer(left)\n      this.dataBuffer.push(new Int8Array(buffer))\n      remaining -= maxSamples\n    }\n  }\n\n  finish() {\n    this.dataBuffer.push(this.encoder.flush())\n    const blob = new Blob(this.dataBuffer, { type: 'audio/mp3' })\n    this.dataBuffer = []\n\n    return {\n      id    : Date.now(),\n      blob  : blob,\n      url   : URL.createObjectURL(blob)\n    }\n  }\n\n  _floatTo16BitPCM(input, output) {\n    for (let i = 0; i < input.length; i++) {\n      const s = Math.max(-1, Math.min(1, input[i]))\n      output[i] = (s < 0 ? s * 0x8000 : s * 0x7FFF)\n    }\n  }\n\n  _convertBuffer(arrayBuffer) {\n    const data = new Float32Array(arrayBuffer)\n    const out = new Int16Array(arrayBuffer.length)\n    this._floatTo16BitPCM(data, out)\n    return out\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/encoder.js","\nexport default class VAD {\n\n  constructor(options) {\n    // Default options\n    this.options = {\n      fftSize: 512*.5,\n      bufferLen: 512*.5, \n      voice_stop: function() {},\n      voice_start: function() {},\n      smoothingTimeConstant: 0.99, \n      energy_offset: 1e-8, // The initial offset.\n      energy_threshold_ratio_pos: 4, // Signal must be twice the offset\n      energy_threshold_ratio_neg: 0.25, // Signal must be half the offset\n      energy_integration: 1, // Size of integration change compared to the signal per second.\n      filter: [\n        {f: 200, v:0}, // 0 -> 200 is 0\n        {f: 2000, v:1} // 200 -> 2k is 1\n      ],\n      source: null,\n      context: null,\n      debug: false,\n    };\n\n    // User options\n    for(var option in options) {\n      if(options.hasOwnProperty(option)) {\n        this.options[option] = options[option];\n      }\n    }\n\n    // Require source\n   if(!this.options.source)\n     throw new Error(\"The options must specify a MediaStreamAudioSourceNode.\");\n\n    // Set this.options.context\n    this.options.context = this.options.source.context;\n\n    // Calculate time relationships\n    this.hertzPerBin = this.options.context.sampleRate / this.options.fftSize;\n    this.iterationFrequency = this.options.context.sampleRate / this.options.bufferLen;\n    this.iterationPeriod = 1 / this.iterationFrequency;\n\n    var DEBUG = this.options.debug;\n    if(DEBUG) {console.log(\n      'Vad' +\n      ' | sampleRate: ' + this.options.context.sampleRate +\n      ' | hertzPerBin: ' + this.hertzPerBin +\n      ' | iterationFrequency: ' + this.iterationFrequency +\n      ' | iterationPeriod: ' + this.iterationPeriod\n    )};\n\n    this.setFilter = function(shape) {\n      this.filter = [];\n      for(var i = 0, iLen = this.options.fftSize / 2; i < iLen; i++) {\n        this.filter[i] = 0;\n        for(var j = 0, jLen = shape.length; j < jLen; j++) {\n          if(i * this.hertzPerBin < shape[j].f) {\n            this.filter[i] = shape[j].v;\n            break; // Exit j loop\n          }\n        }\n      }\n    }\n\n    this.setFilter(this.options.filter);\n\n    this.ready = {};\n    this.vadState = false; // True when Voice Activity Detected\n\n    // Energy detector props\n    this.energy_offset = this.options.energy_offset;\n    this.energy_threshold_pos = this.energy_offset * this.options.energy_threshold_ratio_pos;\n    this.energy_threshold_neg = this.energy_offset * this.options.energy_threshold_ratio_neg;\n\n    this.voiceTrend = 0;\n    this.voiceTrendMax = 10*1.5;\n    this.voiceTrendMin = -5;\n    this.voiceTrendStart = 2;\n    this.voiceTrendEnd = -5;\n    this.damper = 0.02\n    this.voiceTrendMin = this.voiceTrendEnd - this.damper/10;\n    // Create analyser \n    this.analyser = this.options.context.createAnalyser();\n    this.analyser.smoothingTimeConstant = this.options.smoothingTimeConstant; // 0.99;\n    this.analyser.fftSize = this.options.fftSize;\n\n    this.floatFrequencyData = new Float32Array(this.analyser.frequencyBinCount);\n\n    // Setup local storage of the Linear FFT data\n    this.floatFrequencyDataLinear = new Float32Array(this.floatFrequencyData.length);\n\n    // Connect this.analyser\n    this.options.source.connect(this.analyser); \n\n    // Create ScriptProcessorNode\n    this.scriptProcessorNode = this.options.context.createScriptProcessor(this.options.bufferLen, 1, 1);\n\n    // Connect scriptProcessorNode (Theretically, not required)\n    this.scriptProcessorNode.connect(this.options.context.destination);\n\n    // Create callback to update/analyze floatFrequencyData\n    var self = this;\n    this.scriptProcessorNode.onaudioprocess = function(event) {\n      self.analyser.getFloatFrequencyData(self.floatFrequencyData);\n      self.update();\n      self.monitor();\n    };\n\n    // Connect scriptProcessorNode\n    this.options.source.connect(this.scriptProcessorNode);\n\n    // log stuff\n    this.logging = false;\n    this.log_i = 0;\n    this.log_limit = 100;\n\n    this.triggerLog = function(limit) {\n      this.logging = true;\n      this.log_i = 0;\n      this.log_limit = typeof limit === 'number' ? limit : this.log_limit;\n    }\n\n    this.log = function(msg) {\n      if(this.logging && this.log_i < this.log_limit) {\n        this.log_i++;\n        console.log(msg);\n      } else {\n        this.logging = false;\n      }\n    }\n\n    this.update = function() {\n      // Update the local version of the Linear FFT\n      var fft = this.floatFrequencyData;\n      for(var i = 0, iLen = fft.length; i < iLen; i++) {\n        this.floatFrequencyDataLinear[i] = Math.pow(10, fft[i] / 10);\n      }\n      this.ready = {};\n    }\n\n    this.getEnergy = function() {\n      if(this.ready.energy) {\n        return this.energy;\n      }\n\n      var energy = 0;\n      var fft = this.floatFrequencyDataLinear;\n\n      for(var i = 0, iLen = fft.length; i < iLen; i++) {\n        energy += this.filter[i] * fft[i] * fft[i];\n      }\n\n      this.energy = energy;\n      this.ready.energy = true;\n\n      return energy;\n    }\n\n    this.monitor = function() {\n      var energy = this.getEnergy();\n      var signal = energy - this.energy_offset;\n\n      if(signal > this.energy_threshold_pos) {\n        this.voiceTrend = (this.voiceTrend + 1 > this.voiceTrendMax) ? this.voiceTrendMax : this.voiceTrend + 1;\n      } else if(signal < -this.energy_threshold_neg) {\n        this.voiceTrend = (this.voiceTrend - 1 < this.voiceTrendMin) ? this.voiceTrendMin : this.voiceTrend - 1*(this.vadState ? this.damper : 10);\n      } else {\n        // voiceTrend gets smaller\n        if(this.voiceTrend > 0) {\n          this.voiceTrend--;\n        } else if(this.voiceTrend < 0) {\n          this.voiceTrend++;\n        }\n      }\n\n      var start = false, end = false;\n      if(this.voiceTrend > this.voiceTrendStart) {\n        // Start of speech detected\n        start = true;\n      } else if(this.voiceTrend < this.voiceTrendEnd) {\n        // End of speech detected\n        end = true;\n      }\n\n      // Integration brings in the real-time aspect through the relationship with the frequency this functions is called.\n      var integration = signal * this.iterationPeriod * this.options.energy_integration;\n\n      // Idea?: The integration is affected by the voiceTrend magnitude? - Not sure. Not doing atm.\n\n      // The !end limits the offset delta boost till after the end is detected.\n      if(integration > 0 || !end) {\n        this.energy_offset += integration;\n      } else {\n        this.energy_offset += integration * 10;\n      }\n      this.energy_offset = this.energy_offset < 0 ? 0 : this.energy_offset;\n      this.energy_threshold_pos = this.energy_offset * this.options.energy_threshold_ratio_pos;\n      this.energy_threshold_neg = this.energy_offset * this.options.energy_threshold_ratio_neg;\n\n      // Broadcast the messages\n      if(start && !this.vadState) {\n        this.vadState = true;\n        this.options.voice_start();\n      }\n      if(end && this.vadState) {\n        this.vadState = false;\n        this.options.voice_stop();\n      }\n\n      this.log(\n        'e: ' + energy +\n        ' | e_of: ' + this.energy_offset +\n        ' | e+_th: ' + this.energy_threshold_pos +\n        ' | e-_th: ' + this.energy_threshold_neg +\n        ' | signal: ' + signal +\n        ' | int: ' + integration +\n        ' | voiceTrend: ' + this.voiceTrend +\n        ' | start: ' + start +\n        ' | end: ' + end\n      );\n\n      return signal;\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/vad.js","\nexport default class {\n\n  constructor(canvas_id, sourceNode, audioContext){\n    var self = this\n    this.canvas = document.getElementById(canvas_id)\n    this.canvasContext = this.canvas.getContext(\"2d\")\n    this.loop = false\n    this.sourceNode = sourceNode\n    this.audioContext = audioContext\n    this.analyser = audioContext.createAnalyser();\n    this.analyser.fftSize = 32;\n\n\n    this.sourceNode.connect(this.analyser);\n    \n    this.bufferLength = this.analyser.frequencyBinCount;\n    this.dataArray = new Uint8Array(this.analyser.fftSize);\n\n  }\n\n  stop(){\n    this.loop = false\n    var self = this\n    window.setTimeout(function(){self.clearFrame()}, 200)\n  }\n\n  start(){\n    this.canvas.width = this.canvas.clientWidth;\n    this.canvas.height = this.canvas.clientHeight;    \n    this.WIDTH = this.canvas.clientWidth;\n    this.HEIGHT = this.canvas.clientHeight;    \n    this.loop = true\n    this.renderFrame();\n  }\n\n  renderFrame() {\n    var self = this\n    if (self.loop){\n      \n        window.requestAnimationFrame(function(){self.renderFrame()});\n        self.analyser.getByteFrequencyData(self.dataArray);\n        // self.canvasContext.clearRect(0, 0, self.WIDTH, self.HEIGHT);\n        self.canvasContext.fillStyle = \"#333\";\n        self.canvasContext.fillRect(0, 0, self.WIDTH, self.HEIGHT);\n\n        var barWidth = parseInt((self.WIDTH / self.bufferLength))\n        var barHeight = 0\n        var x = 0;\n\n        for (var i = 0; i < self.bufferLength/2; i++) {\n          barHeight = parseInt(self.dataArray[i]/255*self.HEIGHT*.9);\n          \n          var h = 345\n          var s = parseInt(73 * ( self.HEIGHT/barHeight * .5) )\n          var l = parseInt(90 * ( barHeight/self.HEIGHT))\n          \n          self.canvasContext.fillStyle = \"hsl(\" + h + \",\" + s + \"%,\" + l + \"%)\";\n          self.canvasContext.fillRect(2*x+1, self.HEIGHT - barHeight, 2*barWidth-2, barHeight);\n\n          x += barWidth;\n\n      }\n      \n    } else {\n      return;\n    }\n  }\n\n  clearFrame(){\n    var self = this\n    self.canvasContext.clearRect(0, 0, self.WIDTH, self.HEIGHT);\n    self.canvasContext.fillStyle = \"#333\";\n    self.canvasContext.fillRect(0, 0, self.WIDTH, self.HEIGHT);    \n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/visualize.js","import Encoder from './encoder'\nimport { convertTimeMMSS } from '../../node_modules/vue-audio-recorder/src/lib/utils'\nimport VAD from './vad.js'\nimport vis from './visualize'\n\nexport default class {\n  constructor (options = {}) {\n    this.beforeRecording = options.beforeRecording\n    this.pauseRecording  = options.pauseRecording\n    this.putRecording    = options.putRecording\n    this.afterRecording  = options.afterRecording\n    this.micFailed       = options.micFailed\n    this.voiceStop       = options.voiceStop\n    this.voiceStart      = options.voiceStart\n    this.visCanvasID     = options.canvasID || null\n\n    this.bitRate = options.bitRate || 96\n    this.sampleRate = options.sampleRate || 44100\n    this.bufferSize = 4096\n    this.records    = []\n\n    this.isPause     = false\n    this.isRecording = false\n\n    this.duration = 0\n    this.volume   = 0\n\n    this._duration = 0\n\n    this.vad = null\n    this.vis = null\n    this.activity = false\n    this.flush = false\n\n    this.vis = null\n\n    // Set Sample Rate according to device and browser campability\n    this.context = new(window.AudioContext || window.webkitAudioContext)()\n    this.sampleRate = this.context.sampleRate\n    this.context.close()\n  }\n\n\n\n  start () {\n    const constraints = {\n      video: false,\n      audio: {\n        channelCount: 1,\n        echoCancellation: true\n      }\n    }\n\n    this.beforeRecording && this.beforeRecording('start recording')\n\n    navigator.mediaDevices\n             .getUserMedia(constraints)\n             .then(this._micCaptured.bind(this))\n             .catch(this._micError.bind(this))\n    this.isPause = false\n    this.isRecording = true\n\n    this.lameEncoder = new Encoder({bitRate: this.bitRate , sampleRate: this.sampleRate })\n  }\n\n  stop () {\n    if (this.vis){\n      this.vis.stop()\n    }\n\n    this.stream.getTracks().forEach((track) => track.stop())\n    this.input.disconnect()\n    this.processor.disconnect()\n    this.context.close()\n\n    const record = this.lameEncoder.finish()\n    record.duration = convertTimeMMSS(this.duration)\n    // this.records.push(record)\n\n    this._duration = 0\n    this.duration  = 0\n\n    this.isPause     = false\n    this.isRecording = false\n\n    this.afterRecording && this.afterRecording(record)\n    \n  }\n\n  put () {\n    this.stream.getTracks().forEach((track) => track.stop())\n    this.input.disconnect()\n    this.processor.disconnect()\n    this.context.close()\n\n    const record = this.lameEncoder.finish()\n    record.duration = convertTimeMMSS(this.duration)\n    this.records.push(record)\n\n    this._duration = 0\n    this.duration  = 0\n\n    this.isPause     = false\n    this.isRecording = false\n    this.putRecording && this.putRecording(record)\n\n  }\n\n  pause () {\n    this.stream.getTracks().forEach((track) => track.stop())\n    this.input.disconnect()\n    this.processor.disconnect()\n    this.context.close()\n\n    this._duration = this.duration\n    this.isPause = true\n\n    this.pauseRecording && this.pauseRecording('pause recording')\n  }\n\n  recordList () {\n    return this.records\n  }\n\n  lastRecord () {\n    return this.records.slice(-1)\n  }\n\n  _micCaptured (stream) {\n    this.context    = new(window.AudioContext || window.webkitAudioContext)({sampleRate: this.sampleRate})\n    this.duration   = this._duration\n    this.input      = this.context.createMediaStreamSource(stream)\n    this.processor  = this.context.createScriptProcessor(this.bufferSize, 1, 1)\n    this.stream     = stream\n\n    this._voiceStop = () => {\n      this.voiceStop()\n      this.activity = false\n      this.put()\n      this.start()\n    }\n    this._voiceStart = () => {\n      this.voiceStart()\n      this.activity = true\n      this.flush = true\n    }\n\n    var options = {\n      debug: false,\n      source: this.input,\n      voice_stop: this._voiceStop,\n      voice_start: this._voiceStart,\n    }; \n        \n    // Create VAD\n    this.vad = new VAD(options)\n    \n    if (this.visCanvasID){\n      try{\n        this.vis = new vis(this.visCanvasID, this.input, this.input.context)\n        this.vis.start()\n      } catch(error){\n        console.log(error)\n      }\n    }\n\n    this.processor.onaudioprocess = (ev) => {\n      if (this.activity){\n        if (this.flush){\n          this.lameEncoder.flushPrevious(10*1.5)\n          this.flush = false\n        }\n      } else {\n      }\n      const sample = ev.inputBuffer.getChannelData(0)\n      let sum = 0.0\n\n      this.lameEncoder.encode(sample)\n\n      for (let i = 0; i < sample.length; ++i) {\n        sum += sample[i] * sample[i]\n      }\n\n      this.duration = parseFloat(this._duration) + parseFloat(this.context.currentTime.toFixed(2))\n      this.volume = Math.sqrt(sum / sample.length).toFixed(2)\n    }\n\n    this.input.connect(this.processor)\n    this.processor.connect(this.context.destination)\n  }\n\n  _micError (error) {\n    this.micFailed && this.micFailed(error)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/recorder.js","<template>\n  <div class=\"Korero\">\n    <div class=\"header\">\n      <button id=\"startVAD\" v-bind:class=\"{ vad: vadOn, on: recordingOn, 'loading': loadRecording}\">\n        <i class=\"fa fa-microphone\" ></i>\n        <i class=\"fa fa-stop\" ></i>\n        <i class=\"fa fa-spinner fa-spin\"></i>\n      </button>\n      <div id=\"vadStatus\" v-bind:class=\"{ active: vadOn, 'mobile': isMobile()}\">\n        <div>\n          <canvas id=\"canvas\" v-if=\"!isMobile()\"></canvas>\n          <span v-if=\"isMobile() && vadOn && recordingOn\">Voice Detected</span>\n          <span v-if=\"isMobile() && recordingOn && !vadOn\">Listening</span>\n          <span v-if=\"isMobile()\">Hit Record</span>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"body\">\n      <div id=\"transcriptions\">\n        <div v-for=\"(item, index) in transcriptions\" class='transcription' v-bind:class=\"[item.status]\" v-if=\"item.status != 'Failed'\"> \n          <button class=\"delete\" v-if=\"item.status != 'Transcribing'\" v-on:click=\"deleteObject(index)\"><i class=\"fa fa-times\"></i></button>\n          <div class='text'>\n            <i class=\"fa fa-spinner fa-spin\" v-bind:class=\"[item.status]\" v-if=\"item.status == 'Transcribing'\" ></i>\n\n          <div class='confidence'>\n            <div class=\"char\" v-for=\"character in item.metadata\">\n              <div v-if=\"character.char==' '\"\n                   :style=\"{backgroundColor: `rgb(255, 40, 40, ${1-character.prob})`}\">\n                   &nbsp;&nbsp;\n                   <br><span class=\"prob\">&nbsp;{{character.prob.toFixed(2)}}&nbsp;</span>\n              </div>\n              <div v-if=\"character.char!=' '\"\n                   :style=\"{\n                      backgroundColor: `rgba(255, 40, 40, ${1-character.prob})`\n                    }\">\n                  {{character.char}}\n                  <br><span class=\"prob\">&nbsp;{{character.prob.toFixed(2)}}&nbsp;</span>\n              </div>\n            </div>\n          </div>\n\n\n          </div>\n          \n          <div class=\"audio\">\n            <audio v-if=\"item.audio_url\" :src=\"item.audio_url\" type=\"audio/mp3\" controls v-on:play=\"stopRecording\"></audio>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport recorder from '../lib/recorder.js'\nconst ApiAuth = require('../../api_auth')\nconst api_auth = ApiAuth.api_auth;\nconst axios = require('axios');\nexport default {\n  name: 'Kōrero',\n  data () {\n    return {\n      vadOn: false,\n      recordingOn: false,\n      recorder: null,\n      buttonText: 'Start',\n      transcriptions: [],\n      icon: 'fa-microphone',\n      loadRecording: false\n    }\n  },\n  methods: {\n    deleteObject: function (e) {\n      this.transcriptions.splice(e, 1)\n    },\n    stopRecording: function () {\n      try{this.recorder.stop();}\n      catch(e){}\n      this.recorder=null;\n      this.vadOn = false;\n      this.recordingOn = false\n    },   \n    isMobile() {\n      if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Mobile|SamsungBrowser|Opera Mini/i.test(navigator.userAgent)) {\n        console.log(navigator.userAgent)\n        return true\n      } else {\n        return false\n      }\n    }\n  },\n  mounted: function () {\n\n    startVAD.onclick = event => {\n\n      if (this.recorder==null){\n        this.loadRecording = true\n        this.recorder = new recorder({\n          putRecording : (record) => {\n            var transcription = {\n              status: 'Transcribing',\n              text: null,\n              audio: null,\n            }\n            this.transcriptions.unshift(transcription)\n            var formData = new FormData();\n            formData.enctype=\"multipart/form-data\";\n            formData.append('audio_file', record.blob, 'audio_file.mp3')            \n            axios.post(\n              api_auth['url'],\n              formData,\n              {\n                headers: api_auth['headers'],\n              })\n            .then((response) => {\n              if (response.data.transcription == '' || response.data.transcription == ' ' ){\n                transcription.status = 'Failed'\n                return\n              }\n              transcription['text'] = response.data.transcription\n              transcription['metadata'] = response.data.metadata\n              console.log(transcription['metadata'])\n              transcription['audio_url'] = record.url\n              transcription['status'] = 'Success'\n            })\n            .catch((error) => {\n              transcription.status = 'Failed'\n            })\n\n          },\n          afterRecording  : (stream) =>{\n            this.buttonText = 'Start'            \n            this.recorder=null;\n          },\n          pauseRecording  : function(){console.log('paused')},\n          micFailed       : function(){console.log('failed')},\n          voiceStop: () => {\n            \n            this.vadOn = false\n          },\n          voiceStart: () => {\n            this.vadOn = true\n\n          },\n          canvasID: this.isMobile() ? null : 'canvas',\n          bitRate         : 64,\n          sampleRate      : 44100,\n          // format          : this.format\n        })\n      }\n\n      if (this.recordingOn){\n        this.recorder.stop();\n        this.recorder=null;\n        this.vadOn = false;\n        this.recordingOn = false\n        // this.buttonText = 'Start'\n      } else {\n        this.recorder.start()\n        this.recordingOn = true\n        this.buttonText = 'Stop'\n        this.loadRecording = false\n      }\n      \n\n      }\n  }\n}\n</script>\n\n<style scoped>\n\n.Korero {\n  font-family: 'Avenir', Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  text-align: center;\n  color: #2c3e50;\n  font-size: 14px;\n}\nbutton.delete{\n  position: absolute;\n  right: 0px;\n  top: 0px;\n  display: block;\n  border: 0px;\n  margin: 2px;\n  font-size: 0.7em;\n  color: #696969;\n  cursor: pointer;\n  outline: none;\n  background: none;\n}\n.transcription{\n  position: relative;\n  width: 100%;\n  margin: 20px 30px 20px 30px;\n  max-width: 500px;\n  /*margin-top: 20px; */\n  font-size: 1.5em;\n  border-radius: 8px;\n  /*box-shadow: 0px 2px 6px -2px rgba(0,0,0,1)  */\n  border: 1px solid black;\n}\n.transcription.Transcribing{\n  border: 0px;\n}\n.transcription .text {\n  padding: 15px 20px;\n}\n.transcription:nth-of-type(1){\n  margin-top: 40px;\n}\n\ndiv.transcription.Success div.text [class*=fa]{\n  display: none;\n}\n.Korero, .header, .body{\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n}\n.body{\n  height: 100vh;\n  margin-top: -225px;\n}\n.header{\n  padding-bottom: 15px;\n  z-index: 1;\n  background-color: white;\n  padding-left: 15px;\n  padding-right: 15px;  \n}\n#transcriptions{\n  z-index: 0;\n  display: flex;\n  flex-direction: column;\n  overflow-y: scroll;\n  flex-wrap: nowrap;\n  -webkit-overflow-scrolling: touch;\n  -ms-overflow-style: -ms-autohiding-scrollbar; \n  align-items: center;  \n  margin-top: 232px;\n  height: 100vh;    \n  padding-left: 15px;\n  padding-right: 15px;\n}\n\n#vadStatus{\n  display: flex;\n  width: 100%;\n  max-width: 500px;  \n  height: 100px;\n  align-self: center;\n  align-items: center;\n}\n#vadStatus canvas{\n  z-index: 1;\n  display: block;\n  height: 100%;\n  width: 100%;\n  background-color: #333;\n}\n#vadStatus div{\n  height: 100%;\n  width: 100%;\n  border: 4px solid black;\n  border-radius: 4px;\n}\n#vadStatus.active div{\n  border-color: red;\n}\n#vadStatus.mobile{\n  height: 28px;\n  max-width: 150px;  \n}\n#vadStatus.mobile div span{\n  display: block;\n  padding: 4px;\n}\n#vadStatus.mobile div{\n  color: white;\n  font-weight: 700;\n  background-color: black;\n}\n#vadStatus.mobile.active div{\n  background-color: red;\n}\n#startVAD {\n  z-index: 2;\n  align-self: center;\n  margin: 15px;\n  outline: none;\n  background-color: rgb(40,40,40);\n  color: white;\n  width: 80px;\n  height: 80px;\n  border: 2px solid black;\n  border-radius: 40px;\n  padding: 8px 16px;\n  cursor: pointer;\n}\n#startVAD [class*=fa]{\n  font-size: 34px !important;\n}\n#startVAD.on {\n  background-color: rgba(255, 40, 40, 0.75);\n  border-color: rgb(200, 40, 40);\n}\n#startVAD.on.vad {\n  background-color: rgba(255, 40, 40, 1);\n}\n#startVAD.on .fa-microphone{\n  display: none;\n}\n#startVAD .fa-stop, #startVAD .fa-spinner{\n  display: none;\n}\n#startVAD.on .fa-stop{\n  display: initial;\n}\n#startVAD.on.loading .fa-spinner{\n  display: initial;\n}\naudio{\n  outline: none;\n  width: 100%;\n  padding-bottom: 15px;\n}\n.audio{\n  padding: 0px 15px 0px 15px;\n}\ndiv.confidence{\n  display: inline-flex;\n  flex-wrap: wrap;\n}\ndiv.char{\n  line-height: 20px;\n}\nspan.prob{\n  font-size: 8px;\n  line-height: 0px;\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/Korero.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"Korero\"},[_c('div',{staticClass:\"header\"},[_c('button',{class:{ vad: _vm.vadOn, on: _vm.recordingOn, 'loading': _vm.loadRecording},attrs:{\"id\":\"startVAD\"}},[_c('i',{staticClass:\"fa fa-microphone\"}),_vm._v(\" \"),_c('i',{staticClass:\"fa fa-stop\"}),_vm._v(\" \"),_c('i',{staticClass:\"fa fa-spinner fa-spin\"})]),_vm._v(\" \"),_c('div',{class:{ active: _vm.vadOn, 'mobile': _vm.isMobile()},attrs:{\"id\":\"vadStatus\"}},[_c('div',[(!_vm.isMobile())?_c('canvas',{attrs:{\"id\":\"canvas\"}}):_vm._e(),_vm._v(\" \"),(_vm.isMobile() && _vm.vadOn && _vm.recordingOn)?_c('span',[_vm._v(\"Voice Detected\")]):_vm._e(),_vm._v(\" \"),(_vm.isMobile() && _vm.recordingOn && !_vm.vadOn)?_c('span',[_vm._v(\"Listening\")]):_vm._e(),_vm._v(\" \"),(_vm.isMobile())?_c('span',[_vm._v(\"Hit Record\")]):_vm._e()])])]),_vm._v(\" \"),_c('div',{staticClass:\"body\"},[_c('div',{attrs:{\"id\":\"transcriptions\"}},_vm._l((_vm.transcriptions),function(item,index){return (item.status != 'Failed')?_c('div',{staticClass:\"transcription\",class:[item.status]},[(item.status != 'Transcribing')?_c('button',{staticClass:\"delete\",on:{\"click\":function($event){return _vm.deleteObject(index)}}},[_c('i',{staticClass:\"fa fa-times\"})]):_vm._e(),_vm._v(\" \"),_c('div',{staticClass:\"text\"},[(item.status == 'Transcribing')?_c('i',{staticClass:\"fa fa-spinner fa-spin\",class:[item.status]}):_vm._e(),_vm._v(\" \"),_c('div',{staticClass:\"confidence\"},_vm._l((item.metadata),function(character){return _c('div',{staticClass:\"char\"},[(character.char==' ')?_c('div',{style:({backgroundColor: (\"rgb(255, 40, 40, \" + (1-character.prob) + \")\")})},[_vm._v(\"\\n                   \\n                 \"),_c('br'),_c('span',{staticClass:\"prob\"},[_vm._v(\" \"+_vm._s(character.prob.toFixed(2))+\" \")])]):_vm._e(),_vm._v(\" \"),(character.char!=' ')?_c('div',{style:({\n                    backgroundColor: (\"rgba(255, 40, 40, \" + (1-character.prob) + \")\")\n                  })},[_vm._v(\"\\n                \"+_vm._s(character.char)+\"\\n                \"),_c('br'),_c('span',{staticClass:\"prob\"},[_vm._v(\" \"+_vm._s(character.prob.toFixed(2))+\" \")])]):_vm._e()])}),0)]),_vm._v(\" \"),_c('div',{staticClass:\"audio\"},[(item.audio_url)?_c('audio',{attrs:{\"src\":item.audio_url,\"type\":\"audio/mp3\",\"controls\":\"\"},on:{\"play\":_vm.stopRecording}}):_vm._e()])]):_vm._e()}),0)])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-51ab89f1\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Korero.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-51ab89f1\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Korero.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Korero.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Korero.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-51ab89f1\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./Korero.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-51ab89f1\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Korero.vue\n// module id = null\n// module chunks = ","import Vue from 'vue'\nimport Korero from '@/components/Korero'\nimport vueCustomElement from 'vue-custom-element'\nVue.use(vueCustomElement)\nVue.customElement('vue-widget', Korero)\n\n\n\n// WEBPACK FOOTER //\n// ./src/main.js"],"sourceRoot":""}